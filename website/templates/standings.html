<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DriveAhead F1 - Championship Standings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body class="bg-zinc-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-zinc-800 border-b border-zinc-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="DriveAhead F1 Logo" class="h-8 w-8 mr-3">
                    <h1 class="text-xl font-bold">DriveAhead F1</h1>
                    <span class="ml-2 text-xs bg-green-600 px-2 py-1 rounded-full">Live</span>
                </div>
                <div class="flex items-center space-x-8">
                    <a href="/" class="text-gray-300 hover:text-white transition-colors">Home</a>
                    <a href="/telemetry" class="text-gray-300 hover:text-white transition-colors">Telemetry</a>
                    <a href="/standings" class="text-red-500 font-semibold">Standings</a>
                    <a href="/predictions" class="text-gray-300 hover:text-white transition-colors">Live Predictions</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Header -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-white">2024 Championship Standings</h2>
            <p class="text-zinc-400 mt-2">Current Formula 1 World Championship positions</p>
        </div>

        <!-- Standings Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Driver Championship -->
            <div class="bg-zinc-800 rounded-lg border border-zinc-700">
                <div class="p-6 border-b border-zinc-700">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-trophy mr-2 text-yellow-500"></i>
                        Drivers' Championship
                    </h3>
                </div>
                <div class="p-4">
                    <div id="driverStandings" class="space-y-2">
                        <!-- Loading placeholder -->
                        <div class="animate-pulse space-y-3">
                            <div class="flex items-center justify-between p-3 bg-zinc-700 rounded">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-zinc-600 rounded"></div>
                                    <div class="space-y-1">
                                        <div class="h-4 bg-zinc-600 rounded w-32"></div>
                                        <div class="h-3 bg-zinc-600 rounded w-20"></div>
                                    </div>
                                </div>
                                <div class="h-4 bg-zinc-600 rounded w-12"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Constructor Championship -->
            <div class="bg-zinc-800 rounded-lg border border-zinc-700">
                <div class="p-6 border-b border-zinc-700">
                    <h3 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-car mr-2 text-blue-500"></i>
                        Constructors' Championship
                    </h3>
                </div>
                <div class="p-4">
                    <div id="constructorStandings" class="space-y-2">
                        <!-- Loading placeholder -->
                        <div class="animate-pulse space-y-3">
                            <div class="flex items-center justify-between p-3 bg-zinc-700 rounded">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-zinc-600 rounded"></div>
                                    <div class="h-4 bg-zinc-600 rounded w-40"></div>
                                </div>
                                <div class="h-4 bg-zinc-600 rounded w-12"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Last Race Results -->
        <div class="mt-8 bg-zinc-800 rounded-lg border border-zinc-700">
            <div class="p-6 border-b border-zinc-700">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-flag-checkered mr-2 text-red-500"></i>
                    Last Race Results
                </h3>
            </div>
            <div class="p-4">
                <div id="lastRaceResults" class="space-y-2">
                    <!-- Loading placeholder -->
                    <div class="animate-pulse">
                        <div class="h-4 bg-zinc-700 rounded w-1/3 mb-4"></div>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center p-2 bg-zinc-700 rounded">
                                <div class="h-4 bg-zinc-600 rounded w-1/2"></div>
                                <div class="h-4 bg-zinc-600 rounded w-16"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-zinc-800 border-t border-zinc-700 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <p class="text-zinc-400">© 2025 DriveAhead F1 - Advanced Analytics</p>
                    <p class="text-xs text-zinc-500">Championship Standings • Manual Updates</p>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-xs text-zinc-400">Last Updated:</span>
                    <span class="text-xs text-green-400" id="lastUpdated">Loading...</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        class StandingsPage {
            constructor() {
                this.loadStandings();
                this.loadLastRace();
            }

            async loadStandings() {
                try {
                    const response = await fetch('/api/standings');
                    const data = await response.json();
                    
                    if (data.drivers && data.constructors) {
                        this.renderDriverStandings(data.drivers);
                        this.renderConstructorStandings(data.constructors);
                        
                        const updateTime = new Date(data.last_updated).toLocaleString();
                        document.getElementById('lastUpdated').textContent = updateTime;
                    }
                } catch (error) {
                    console.error('Error loading standings:', error);
                    this.showError('Failed to load standings data');
                }
            }

            renderDriverStandings(drivers) {
                const container = document.getElementById('driverStandings');
                
                container.innerHTML = drivers.map((driver, index) => {
                    const position = parseInt(driver.position);
                    let bgColor = 'bg-zinc-700';
                    
                    if (position === 1) bgColor = 'bg-yellow-900/30 border-l-4 border-yellow-500';
                    else if (position === 2) bgColor = 'bg-gray-900/30 border-l-4 border-gray-400';
                    else if (position === 3) bgColor = 'bg-orange-900/30 border-l-4 border-orange-600';
                    else if (position <= 10) bgColor = 'bg-green-900/20 border-l-4 border-green-600';
                    
                    return `
                        <div class="flex items-center justify-between p-3 ${bgColor} rounded hover:bg-zinc-600 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-zinc-600 rounded-full flex items-center justify-center">
                                    <span class="text-sm font-bold mono">${position}</span>
                                </div>
                                <div>
                                    <div class="font-medium">${driver.driver}</div>
                                    <div class="text-sm text-zinc-400">${driver.team}</div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold mono text-yellow-400">${driver.points}</div>
                                <div class="text-xs text-zinc-500">PTS</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderConstructorStandings(constructors) {
                const container = document.getElementById('constructorStandings');
                
                container.innerHTML = constructors.map((constructor, index) => {
                    const position = parseInt(constructor.position);
                    let bgColor = 'bg-zinc-700';
                    
                    if (position === 1) bgColor = 'bg-yellow-900/30 border-l-4 border-yellow-500';
                    else if (position === 2) bgColor = 'bg-gray-900/30 border-l-4 border-gray-400';
                    else if (position === 3) bgColor = 'bg-orange-900/30 border-l-4 border-orange-600';
                    
                    return `
                        <div class="flex items-center justify-between p-3 ${bgColor} rounded hover:bg-zinc-600 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 bg-zinc-600 rounded-full flex items-center justify-center">
                                    <span class="text-sm font-bold mono">${position}</span>
                                </div>
                                <div class="font-medium">${constructor.team}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold mono text-yellow-400">${constructor.points}</div>
                                <div class="text-xs text-zinc-500">PTS</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            async loadLastRace() {
                try {
                    const response = await fetch('/api/last-race');
                    const data = await response.json();
                    
                    if (data.race) {
                        this.renderLastRace(data.race);
                    }
                } catch (error) {
                    console.error('Error loading last race:', error);
                }
            }

            renderLastRace(race) {
                const container = document.getElementById('lastRaceResults');
                
                if (!race.Results) {
                    container.innerHTML = '<p class="text-zinc-400">No race results available</p>';
                    return;
                }

                container.innerHTML = `
                    <div class="mb-4">
                        <h4 class="text-lg font-semibold text-white">${race.raceName}</h4>
                        <p class="text-zinc-400">${race.Circuit.circuitName} • ${new Date(race.date).toLocaleDateString()}</p>
                    </div>
                    
                    <div class="space-y-2">
                        ${race.Results.slice(0, 10).map(result => `
                            <div class="flex justify-between items-center p-2 bg-zinc-700 rounded hover:bg-zinc-600 transition-colors">
                                <div class="flex items-center space-x-3">
                                    <span class="w-6 text-center font-mono text-sm">${result.position}</span>
                                    <span class="font-medium">${result.Driver.givenName} ${result.Driver.familyName}</span>
                                    <span class="text-sm text-zinc-400">${result.Constructor.name}</span>
                                </div>
                                <span class="mono text-sm">${result.Time ? result.Time.time : result.status}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            showError(message) {
                const containers = ['driverStandings', 'constructorStandings', 'lastRaceResults'];
                containers.forEach(id => {
                    const container = document.getElementById(id);
                    if (container) {
                        container.innerHTML = `<p class="text-red-400 text-center p-4">${message}</p>`;
                    }
                });
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new StandingsPage();
        });
    </script>
</body>
</html>